<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=520" />
	<title>InfBuild: ACEINF Aircraft Set Builder / Damage Calculator</title>
	<link rel="stylesheet" href="styles/style.css" type="text/css" />
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/knockout/3.4.0/knockout-min.js"></script>
	<script src="components/knockout-es5/dist/knockout-es5.min.js"></script>
	<script src="components/knockout-fast-foreach/dist/knockout-fast-foreach.min.js"></script>
	<script src="components/knockout-projections/dist/knockout-projections.min.js"></script>
	<script src="components/knockout-repeat/knockout-repeat.js"></script>
	<script src="app.js"></script>
	<script src="ver.js"></script>
	<script src="data.js"></script>
</head>

<body>
	<div id="parameters">
		<header>
			<h1>
				InfBuild
				<span id="variant" data-bind="text: Version.variant ? '/' + Version.variant + '/' : ''"></span>
				<span id="version" data-bind="text: Version.version"></span>
			</h1>
			<div id="languages">
				<label for="languages-en" data-bind="css: { checked: language == 'en' }">
					<input id="languages-en" type="radio" value="en" data-bind="checked: language" />en
				</label>
				<label for="languages-ja" data-bind="css: { checked: language == 'ja' }">
					<input id="languages-ja" type="radio" value="ja" data-bind="checked: language" />ja
				</label>
			</div>
			<p>
				ACEINF Aircraft Set Builder / Damage Calculator
			</p>
			<nav>
				<button data-bind="click: reset">Reset</button>
				<button data-bind="click: aircraftSets.showLoad.bind(aircraftSets)">Load</button>
				<button data-bind="click: aircraftSets.showSave.bind(aircraftSets)">Save</button>
				<button data-bind="click: code.showText.bind(code)">Text</button>
				<button data-bind="click: tweet">Tweet</button>
			</nav>
		</header>
		<form>
			<fieldset id="load-aircraftset" class="hidden" data-bind="with: aircraftSets">
				<legend>
					Load Aircraft Set
				</legend>
				<ul>
					<li>
						<label>Aircraft Sets</label>
						<select size="8" data-bind="value: selectedSet, options: sets, optionsText: 'name'"></select>
					</li>
					<li>
						<label>Selected Set</label>
						<ul data-bind="foreach: selectedSet ? selectedSet.codes.map(function(_) { return  Calculator.load(resources, _) }) : []">
							<li>
								<span data-bind="text: aircraft.name + ' Lv.' + level"></span>
								<span class="note" data-bind="text: specialWeapon.name + ' Lv.' + specialWeaponLevel"></span>
							</li>
						</ul>
					</li>
					<li>
						<button type="submit" data-bind="click: load, enable: selectedSet">Load</button>
						<button type="reset" data-bind="click: hideLoad">Cancel</button>
					</li>
				</ul>
			</fieldset>
		</form>
		<form>
			<fieldset id="save-aircraftset" class="hidden" data-bind="with: aircraftSets">
				<legend>
					Save Aircraft Set
				</legend>
				<ul>
					<li>
						<label>Aircraft Sets</label>
						<select size="8" data-bind="value: selectedSet, options: sets, optionsText: 'name', optionsCaption: 'Save new...'"></select>
					</li>
					<li>
						<label>Selected Set</label>
						<ul data-bind="foreach: selectedSet ? selectedSet.codes.map(function(_) { return  Calculator.load(resources, _) }) : []">
							<li>
								<span data-bind="text: aircraft.name + ' Lv.' + level"></span>
								<span class="note" data-bind="text: specialWeapon.name + ' Lv.' + specialWeaponLevel"></span>
							</li>
						</ul>
					</li>
					<li>
						<label>Set Name</label>
						<input id="save-aircraftset-name" type="text" data-bind="value: setSaveName" />
					</li>
					<li>
						<button type="submit" data-bind="click: save">Save</button>
						<button data-bind="click: remove, enable: selectedSet">Delete</button>
						<button type="reset" data-bind="click: hideSave">Cancel</button>
					</li>
				</ul>
			</fieldset>
		</form>
		<form>
			<fieldset id="text" class="hidden" data-bind="with: code">
				<legend>Text Output</legend>
				<ul>
					<li>
						<textarea id="text-output" readonly="readonly" data-bind="click: function() { $('#text-output').focus().select() }"></textarea>
					</li>
					<li>
						<button type="reset" data-bind="click: hideText">Close</button>
					</li>
				</ul>
			</fieldset>
		</form>
		<form>
			<fieldset id="aircraft" data-bind="with: selectedCalculator">
				<legend>
					Aircraft
					<span class="note">
					Cst: <span data-bind="text: leveledAircraftCost"></span>
					</span>
				</legend>
				<ul class="aircraft">
					<li>
						<label for="aircraft-name">
							Aircraft
							<span class="note" data-bind="css: { uncertain: aircraft.isHandicapUncertain }">
								Cst: <span data-bind="text: aircraft.cost"></span> (<span data-bind="text: aircraft.handicap >= 0 ? '+' + aircraft.handicap : aircraft.handicap"></span>)
							</span>
						</label>
						<span id="aircraft-select">
							<select id="aircraft-role" data-bind="value: $root.selectedRole, css: 'role-' + ['f', 'm', 'a', 'b', 'pf'][$root.selectedRole]">
								<option class="role-f" value="0">F</option>
								<option class="role-m" value="1">M</option>
								<option class="role-a" value="2">A</option>
								<option class="role-b" value="3">B</option>
								<option class="role-pf" value="4">PF</option>
							</select>
							<select id="aircraft-list" data-bind="value: aircraft, options: $root.aircraftsByRole, optionsText: 'name'"></select>
							<input id="aircraft-name" autocomplete="off" list="aircraft-name-list" data-bind="value: $root.aircraftName, event: { focus: function() { $('#aircraft-name').val(''); return true }, blur: function() { $root.selectingAircraft = false; $('#aircraft-name').val($root.aircraftName); return true } }" />
							<datalist id="aircraft-name-list" data-bind="fastForEach: resources.aircraftList">
								<option data-bind="text: name"></option>
							</datalist>
						</span>
					</li>
					<li>
						<label for="aircraft-lv">
							Lv.
							<span class="note" data-bind="css: { uncertain: mainWeapon.isLevelRateUncertain }">
								Internal Power: <span data-bind="text: realLevel"></span>
							</span>
						</label>
						<select id="aircraft-lv" data-bind="value: level, options: Array.apply(null, { length: 20 }).map(eval.call, Number).map(function(_) { return _ + 1 })"></select>
					</li>
					<li>
						<label for="aircraft-exslot">Slot Extensions</label>
						<input id="aircraft-exslot" type="number" min="0" data-bind="value: extendedSlots" />
					</li>
				</ul>
			</fieldset>

			<fieldset id="spw" data-bind="with: selectedCalculator">
				<legend>
					Special Weapon
					<span class="note">
					Cst: <span data-bind="text: specialWeapon.costs[specialWeaponLevel - 1]"></span>
					</span>
				</legend>
				<ul>
					<li>
						<label for="spw-name">SP.W</label>
						<select id="spw-name" data-bind="value: specialWeapon, css: 'spw-' + ['a', 'g', 'o'][specialWeapon.role], options: aircraft.specialWeapons, optionsText: 'name', optionsAfterRender: function(tag, item) { tag.className = 'spw-' + ['a', 'g', 'o'][item.role]; }"></select>
					</li>
					<li>
						<label for="spw-lv">
						Lv.
						<span class="note" data-bind="css: { uncertain: specialWeapon.isLevelRateUncertain }">
							Internal Power: <span data-bind="text: realSpecialWeaponLevel"></span>
						</span>
					</label>
						<select id="spw-lv" data-bind="value: specialWeaponLevel, options: [1, 2, 3, 4, 5]"></select>
					</li>
				</ul>
			</fieldset>

			<fieldset id="datalink" data-bind="with: selectedCalculator">
				<legend>
					Datalink
				</legend>
				<ul>
					<li>
						<label for="datalink-name">Datalink</label>
						<select id="datalink-name" data-bind="value: datalink, options: $root.resources.datalinkList, optionsText: $root.language == 'ja' ? 'name' : 'englishName'"></select>
					</li>
					<li data-bind="if: datalink.id == 2">
						<label for="datalink-active">
						Critical
						<span class="note">
							Internal Power: <span data-bind="text: criticalActive ? '1' : 0"></span>
						</span>
					</label>
						<label for="datalink-active"><input id="datalink-active" type="checkbox" data-bind="checked: criticalActive" /> Datalink Active</label>
					</li>
				</ul>
			</fieldset>

			<fieldset id="parts">
				<div id="parts-header">
					<legend data-bind="with: selectedCalculator">
						Equipments
						<span class="note">
						<span class="slots-body">BODY: <span data-bind="text: slotUsage[0], css: { 'slots-exceed': slotUsage[0] > maxSlots[0] }"></span>/<span data-bind="text: maxSlots[0]"></span></span>
						<span class="slots-arms">ARMS: <span data-bind="text: slotUsage[1], css: { 'slots-exceed': slotUsage[1] > maxSlots[1] }"></span>/<span data-bind="text: maxSlots[1]"></span></span>
						<span class="slots-misc">MISC: <span data-bind="text: slotUsage[2], css: { 'slots-exceed': slotUsage[2] > maxSlots[2] }"></span>/<span data-bind="text: maxSlots[2]"></span></span>
						<span id="parts-ttlcst">TtlCst: <span data-bind="text: totalCost"></span></span>
						<span data-bind="text: totalEquipCost"></span> Cr
						</span>
					</legend>
					<div id="parts-categories" data-bind="fastForEach: ['Current', 'Speed', 'Mobility', 'Defense', 'MSL', 'SP.M', 'SP.B', 'SP.O', 'Misc']">
						<label data-bind="css: { checked: $root.selectedPartsCategory == $data }, attr: { 'for': 'parts-categories-' + $data.replace(/\./g, '').toLowerCase() }">
						<input data-bind="value: $data, checked: $root.selectedPartsCategory, attr: { 'id': 'parts-categories-' + $data.replace(/\./g, '').toLowerCase() }" type="radio" />
						<span data-bind="text: $data"></span>
					</label>
					</div>
				</div>
				<div id="parts-categorized" data-bind="with: selectedCalculator, css: { empty: !$root.partsByCategory.length }">
					<!--ko if: $root.partsByCategory.length -->
					<ul data-bind="css: 'parts-categorized-' + $root.selectedPartsCategory.toLowerCase(), foreach: $root.partsByCategory">
						<li data-bind="css: { 'checked': ~$parent.parts.indexOf($data), 'category-checked': $parent.parts.some(function(_) { return _.sizeGroup && _.sizeGroup == sizeGroup }), 'unsupported': !isSupported($parent.aircraft.role, $parent.mainWeapon) && !isSupported($parent.aircraft.role, $parent.specialWeapon), 'disabled': $parent.parts.length >= 7 && !~$parent.parts.indexOf($data) }">
							<label data-bind="attr: { 'for': 'parts-categorized-' + index }">
							<input data-bind="value: $data, checked: $parent.parts, attr: { id: 'parts-categorized-' + index }, disable: $parent.parts.length >= 7 && !~$parent.parts.indexOf($data)" type="checkbox" />
							<span class="parts-name" data-bind="text: $root.language == 'ja' ? name : englishName"></span>
							<!--ko if: power --><span class="parts-power" data-bind="text: '+' + power"></span><!--/ko -->
							<!--ko if: hits --><span class="parts-hits" data-bind="text: '+' + hits + 'hits'"></span><!--/ko -->
							<span class="parts-slots" data-bind="text: slotUsage, css: 'slots-' + ['body', 'arms', 'misc'][slot]"></span>
							<span class="parts-cost" data-bind="text: 'Cst: ' + cost"></span>
							<span class="parts-price" data-bind="text: getPrice($parent.aircraft) + ' Cr'"></span>
						</label>
						</li>
					</ul>
					<!--/ko -->
				</div>
			</fieldset>
		</form>
	</div>

	<form id="results">
		<div id="results-options">
			<select data-bind="value: selectedStage, options: resources.stageList, optionsText: 'name', optionsCaption: 'Filter...'"></select>
			<button data-bind="click: addCalculator">Add Aircraft</button>
			<button data-bind="click: removeCalculator, disable: calculators.length <= 1">Remove Aircraft</button>
		</div>

		<div id="enemies">
			<dl data-bind="fastForEach: enemies[0]">
				<dt data-bind="text: $root.getHitPoint($data), css: $root.getHitPointClass($data)"></dt>
				<dd data-bind="css: $root.getEnemyColor($data)">
					<span class="enemy-id" data-bind="html: name"></span>
					<span class="note">
						<span class="enemy-score" data-bind="text: score"></span>
						<span data-bind="html: $root.getEnemySpecialEffetcs($data)"></span>
					</span>
				</dd>
			</dl>

			<dl data-bind="fastForEach: enemies[1]">
				<dt data-bind="text: $root.getHitPoint($data), css: $root.getHitPointClass($data)"></dt>
				<dd data-bind="css: $root.getEnemyColor($data)">
					<span class="enemy-id" data-bind="html: name"></span>
					<span class="note">
						<span class="enemy-score" data-bind="text: score"></span>
						<span data-bind="html: $root.getEnemySpecialEffetcs($data)"></span>
					</span>
				</dd>
			</dl>
		</div>

		<div id="gauges">
			<ul id="results-air" class="results-gauges" data-bind="foreach: calculators">
				<li data-bind="css: { selected: $root.selectedCalculator == $data, 'results-has-strong': $data.specialWeapon.strongMultiplier, 'results-has-weak': $data.specialWeapon.weakDivider }">
					<label data-bind="attr: { 'for': 'gauges-aircraft-' + $index() }">
						<input name="selectedCalculator" type="radio" data-bind="value: $data, checked: $root.selectedCalculator, attr: { 'id': 'gauges-aircraft-' + $index() }" />
						<span data-bind="text: aircraft.name"></span><br />
						Lv.<span data-bind="text: level"></span>
						<span class="note">
							<span data-bind="text: specialWeapon.name"></span> Lv.<span data-bind="text: specialWeaponLevel"></span>
						</span>
					</label>
					<span data-bind="repeat: { count: 2 + ($data.specialWeapon.strongMultiplier ? 1 : 0) + ($data.specialWeapon.weakDivider ? 1 : 0), index: '$type' }">
						<span data-bind="repeat: { count: [mainWeapon, specialWeapon, specialWeapon, specialWeapon][$type].numberOfGauges, reverse: true, index: '$gauge' }">
							<span class="results-gauge" data-bind="css: $root.getGaugeClass($data, 0, $type, $gauge), style: { height: $root.getGauges($data, 0, $type, $gauge).length }">
								<span data-bind="html: $root.getGauges($data, 0, $type, $gauge).text"></span>
							</span>
						</span>
					</span>
				</li>
			</ul>
			<ul id="results-ground" class="results-gauges" data-bind="foreach: calculators">
				<li data-bind="css: { selected: $root.selectedCalculator == $data, 'results-has-strong': $data.specialWeapon.strongMultiplier, 'results-has-weak': $data.specialWeapon.weakDivider }">
					<label data-bind="click: function() { $root.selectedCalculator = $data }">
						<span data-bind="text: aircraft.name"></span><br />
						Lv.<span data-bind="text: level"></span>
						<span class="note">
							<span data-bind="text: specialWeapon.name"></span> Lv.<span data-bind="text: specialWeaponLevel"></span>
						</span>
					</label>
					<span data-bind="repeat: { count: 2 + ($data.specialWeapon.strongMultiplier ? 1 : 0) + ($data.specialWeapon.weakDivider ? 1 : 0), index: '$type' }">
						<span data-bind="repeat: { count: [mainWeapon, specialWeapon, specialWeapon, specialWeapon][$type].numberOfGauges, reverse: true, index: '$gauge' }">
							<span class="results-gauge" data-bind="css: $root.getGaugeClass($data, 1, $type, $gauge), style: { height: $root.getGauges($data, 1, $type, $gauge).length }">
								<span data-bind="html: $root.getGauges($data, 1, $type, $gauge).text"></span>
							</span>
						</span>
					</span>
				</li>
			</ul>
		</div>
	</form>

	<footer>
		<nav>
			<ul>
				<li>
					<a href="https://github.com/InfBuild/InfBuild">View source on GitHub</a>
				</li>
				<li>
					<a href="#about">About</a>
				</li>
			</ul>
		</nav>
	</footer>

	<div id="about" class="dialog hidden">
		<section>
			<h1>About InfBuild</h1>
			<dl>
				<dt>Main Developer</dt>
				<dd>
					<a href="https://twitter.com/mfakane">mfakane</a>
				</dd>
				<dt>Original damage calculation methods</dt>
				<dd>
					Original damage calculation methods are from <a href="http://berkut.blog.jp/">Berkut Method</a>.
				</dd>
				<dt>Database</dt>
				<dd>
					InfBuild is using data from <a href="https://github.com/InfBuild/InfData">InfData</a>, a repository for gathering data for ACEINF.
				</dd>
				<dt>License</dt>
				<dd>
					InfBuild is licensed under the <a href="https://opensource.org/licenses/MIT">MIT License</a>.
				</dd>
			</dl>
		</section>
	</div>
</body>

</html>